<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ポケモンすばやさ比較ツール</title>
  <style>
    body { font-family: sans-serif; background: #f0f2f5; padding: 20px; max-width: 900px; margin: auto; }
    h1 { text-align: center; color: #333; }
    .pokemon-select { display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 20px; }
    .box { flex: 1; background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1); min-width: 300px; }
    select, button { width: 100%; padding: 8px; margin-top: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    .compare-result { margin-top: 20px; font-weight: bold; text-align: center; }
    .rank-buttons { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px; }
    .rank-buttons button { flex: 1; min-width: 40px; }
  </style>
</head>
<body>
  <h1>ポケモンすばやさ比較ツール</h1>
  <div class="pokemon-select">
    <div class="box">
      <label for="poke1">ポケモンA</label>
      <select id="poke1" onchange="showSpeed('poke1', 'table1', 'rank1')">
        <option value="">選択してください</option>
      </select>
      <div class="rank-buttons" id="rank1"></div>
      <table id="table1"></table>
    </div>
    <div class="box">
      <label for="poke2">ポケモンB</label>
      <select id="poke2" onchange="showSpeed('poke2', 'table2', 'rank2')">
        <option value="">選択してください</option>
      </select>
      <div class="rank-buttons" id="rank2"></div>
      <table id="table2"></table>
    </div>
  </div>
  <div class="compare-result" id="result"></div>

  <script>
    const nameMap = {
      "ミライドン": "miraidon",
      "ガオガエン": "incineroar",
      "連撃ウーラオス": "urshifu-rapid-strike",
      "黒馬バドレックス": "calyrex-shadow",
      "白馬バドレックス": "calyrex-ice",
      "ゴリランダー": "rillaboom",
      "ザマゼンタ": "zamazenta",
      "エルフーン": "whimsicott",
      "カイオーガ": "kyogre",
      "トルネロス": "tornadus"
    };

    const rankMultipliers = {
      "-6": 2/8, "-5": 2/7, "-4": 2/6, "-3": 2/5, "-2": 2/4, "-1": 2/3,
      "0": 2/2, "+1": 3/2, "+2": 4/2, "+3": 5/2, "+4": 6/2, "+5": 7/2, "+6": 8/2
    };

    const baseSpeeds = {};

    async function fetchBaseSpeed(japaneseName) {
      const englishName = nameMap[japaneseName];
      if (!englishName) return null;
      try {
        const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${englishName}`);
        const data = await res.json();
        const speedStat = data.stats.find(stat => stat.stat.name === "speed");
        baseSpeeds[japaneseName] = speedStat.base_stat;
      } catch (err) {
        console.error(`⚠️ ${japaneseName} の取得に失敗しました`, err);
        baseSpeeds[japaneseName] = 100; // 仮の数値
      }
    }

    async function preloadBaseSpeeds() {
      const promises = Object.keys(nameMap).map(name => fetchBaseSpeed(name));
      await Promise.all(promises);
      populateSelectors();
    }

    function populateSelectors() {
      const poke1 = document.getElementById('poke1');
      const poke2 = document.getElementById('poke2');
      for (const name in nameMap) {
        const option1 = document.createElement('option');
        option1.value = name;
        option1.textContent = name;
        poke1.appendChild(option1);

        const option2 = document.createElement('option');
        option2.value = name;
        option2.textContent = name;
        poke2.appendChild(option2);
      }
      createRankButtons('rank1', 'poke1', 'table1');
      createRankButtons('rank2', 'poke2', 'table2');
    }

    function createRankButtons(containerId, selectId, tableId) {
      const container = document.getElementById(containerId);
      for (const rank in rankMultipliers) {
        const btn = document.createElement('button');
        btn.textContent = rank;
        btn.onclick = () => {
          container.querySelectorAll('button').forEach(b => b.disabled = false);
          btn.disabled = true;
          showSpeed(selectId, tableId, containerId, rank);
        };
        if (rank === "0") btn.disabled = true;
        container.appendChild(btn);
      }
    }

    function showSpeed(selectId, tableId, rankContainerId, selectedRank = "0") {
      const name = document.getElementById(selectId).value;
      const table = document.getElementById(tableId);
      table.innerHTML = '';
      if (!name || !(name in baseSpeeds)) return;

      const base = baseSpeeds[name];
      const mult = rankMultipliers[selectedRank];

      const natureMultipliers = [1.1, 1.0, 0.9, 0.85, 0.8];
      const ranks = ["最速", "準速", "無振", "下降1", "下降2"];

      let html = '<tr><th>ランク</th><th>すばやさ（補正込み）</th></tr>';
      for (let i = 0; i < ranks.length; i++) {
        const speed = Math.floor(base * natureMultipliers[i] * mult);
        html += `<tr><td>${ranks[i]}</td><td>${speed}</td></tr>`;
      }
      table.innerHTML = html;

      compare();
    }

    function compare() {
      const poke1 = document.getElementById('poke1').value;
      const poke2 = document.getElementById('poke2').value;
      const result = document.getElementById('result');
      if (!poke1 || !poke2 || !(poke1 in baseSpeeds) || !(poke2 in baseSpeeds)) {
        result.innerHTML = '';
        return;
      }
      const rank1 = document.querySelector('#rank1 button:disabled').textContent;
      const rank2 = document.querySelector('#rank2 button:disabled').textContent;
      const speed1 = Math.floor(baseSpeeds[poke1] * 1.1 * rankMultipliers[rank1]);
      const speed2 = Math.floor(baseSpeeds[poke2] * 1.1 * rankMultipliers[rank2]);

      let msg = '';
      if (speed1 > speed2) msg = `${poke1}（${rank1}）は ${poke2}（${rank2}）より速いです。`;
      else if (speed1 < speed2) msg = `${poke2}（${rank2}）は ${poke1}（${rank1}）より速いです。`;
      else msg = `${poke1} と ${poke2} は同速（${rank1}）です。`;

      result.innerText = msg;
    }

    preloadBaseSpeeds();
  </script>
</body>
</html>
